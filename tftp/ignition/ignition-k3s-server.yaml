variant: fcos
version: 1.0.0

passwd:
  users:
    - name: core
      ssh_authorized_keys:
        - "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCYA8hVwKoy7GMl6Nq87gfxw1iBT7zxvBJidFV+2dHUVomQwGvGVByIND5Ffl2QznJKeCAEyiUDI6hxrUuRlGXITKkCJlz4J5s0Rql8VPxvW9P2VlOuxPikZnsla5rNJrtAFo0n2Kh8CgjwICOqp8Gh/qNV8D3DaIRSB8TWedDH8+wnUlNj8BNilNZ72MTjIsV2DCPNAIyFxCspbLJ5vsoj0XUInQKh+IaW9A4xxJ6jVOmA76yaeDTsBFYI+KJ2+/01pcpxH/r0iZ4QwoK6wTjf4I7EPNCCenGa6TscquQaSznjLhJEJS+JWiwtuHhGQKIxAKduOk0G6+kc7QDD4EpJ afa@AFA-PC"

storage:

  disks:
    - device: /dev/sdb
      wipe_table: true

  files:
    # K3S
    - path: "/usr/local/bin/k3s"
      user:
        name: root
      group:
        name: root
      mode: 0755
      contents:
        source: "https://github.com/rancher/k3s/releases/download/v1.0.0/k3s"
        verification:
          hash: sha512-bbea8cd86a5c660e646b002a013593d25d9c20bb1194f2d9bd4ecaa60eb9d43bda368e313c5f09df6c6d5d2602e3235bb366336c1a2fd57f3042f05ff09f3de4
    - path: "/usr/local/etc/k3s/token"
      user:
        name: root
      group:
        name: root
      mode: 0400
      contents:
        source: "data:text/plain;charset=utf-8;base64,NWVhOWNiNTktMjc0NC0zMmE2LWJmZWMtZThlN2NhNmIxMTU5"
    # Traefik v2
    - path: "/opt/traefik/traefik-01-common.yaml"
      user:
        name: root
      group:
        name: root
      mode: 0644
      contents:
        # cat traefik/01-common.yaml | base64 -w 0
        source: "data:text/plain;charset=utf-8;base64,YXBpVmVyc2lvbjogdjEKa2luZDogTmFtZXNwYWNlCm1ldGFkYXRhOgogIG5hbWU6IHRyYWVmaWsKCi0tLQphcGlWZXJzaW9uOiBhcGlleHRlbnNpb25zLms4cy5pby92MWJldGExCmtpbmQ6IEN1c3RvbVJlc291cmNlRGVmaW5pdGlvbgptZXRhZGF0YToKICBuYW1lOiBpbmdyZXNzcm91dGVzLnRyYWVmaWsuY29udGFpbm8udXMKCnNwZWM6CiAgZ3JvdXA6IHRyYWVmaWsuY29udGFpbm8udXMKICB2ZXJzaW9uOiB2MWFscGhhMQogIG5hbWVzOgogICAga2luZDogSW5ncmVzc1JvdXRlCiAgICBwbHVyYWw6IGluZ3Jlc3Nyb3V0ZXMKICAgIHNpbmd1bGFyOiBpbmdyZXNzcm91dGUKICBzY29wZTogTmFtZXNwYWNlZAoKLS0tCmFwaVZlcnNpb246IGFwaWV4dGVuc2lvbnMuazhzLmlvL3YxYmV0YTEKa2luZDogQ3VzdG9tUmVzb3VyY2VEZWZpbml0aW9uCm1ldGFkYXRhOgogIG5hbWU6IGluZ3Jlc3Nyb3V0ZXRjcHMudHJhZWZpay5jb250YWluby51cwoKc3BlYzoKICBncm91cDogdHJhZWZpay5jb250YWluby51cwogIHZlcnNpb246IHYxYWxwaGExCiAgbmFtZXM6CiAgICBraW5kOiBJbmdyZXNzUm91dGVUQ1AKICAgIHBsdXJhbDogaW5ncmVzc3JvdXRldGNwcwogICAgc2luZ3VsYXI6IGluZ3Jlc3Nyb3V0ZXRjcAogIHNjb3BlOiBOYW1lc3BhY2VkCgotLS0KYXBpVmVyc2lvbjogYXBpZXh0ZW5zaW9ucy5rOHMuaW8vdjFiZXRhMQpraW5kOiBDdXN0b21SZXNvdXJjZURlZmluaXRpb24KbWV0YWRhdGE6CiAgbmFtZTogbWlkZGxld2FyZXMudHJhZWZpay5jb250YWluby51cwoKc3BlYzoKICBncm91cDogdHJhZWZpay5jb250YWluby51cwogIHZlcnNpb246IHYxYWxwaGExCiAgbmFtZXM6CiAgICBraW5kOiBNaWRkbGV3YXJlCiAgICBwbHVyYWw6IG1pZGRsZXdhcmVzCiAgICBzaW5ndWxhcjogbWlkZGxld2FyZQogIHNjb3BlOiBOYW1lc3BhY2VkCgotLS0KYXBpVmVyc2lvbjogYXBpZXh0ZW5zaW9ucy5rOHMuaW8vdjFiZXRhMQpraW5kOiBDdXN0b21SZXNvdXJjZURlZmluaXRpb24KbWV0YWRhdGE6CiAgbmFtZTogdGxzb3B0aW9ucy50cmFlZmlrLmNvbnRhaW5vLnVzCgpzcGVjOgogIGdyb3VwOiB0cmFlZmlrLmNvbnRhaW5vLnVzCiAgdmVyc2lvbjogdjFhbHBoYTEKICBuYW1lczoKICAgIGtpbmQ6IFRMU09wdGlvbgogICAgcGx1cmFsOiB0bHNvcHRpb25zCiAgICBzaW5ndWxhcjogdGxzb3B0aW9uCiAgc2NvcGU6IE5hbWVzcGFjZWQKCi0tLQphcGlWZXJzaW9uOiBhcGlleHRlbnNpb25zLms4cy5pby92MWJldGExCmtpbmQ6IEN1c3RvbVJlc291cmNlRGVmaW5pdGlvbgptZXRhZGF0YToKICBuYW1lOiB0cmFlZmlrc2VydmljZXMudHJhZWZpay5jb250YWluby51cwoKc3BlYzoKICBncm91cDogdHJhZWZpay5jb250YWluby51cwogIHZlcnNpb246IHYxYWxwaGExCiAgbmFtZXM6CiAgICBraW5kOiBUcmFlZmlrU2VydmljZQogICAgcGx1cmFsOiB0cmFlZmlrc2VydmljZXMKICAgIHNpbmd1bGFyOiB0cmFlZmlrc2VydmljZQogIHNjb3BlOiBOYW1lc3BhY2VkCgotLS0Ka2luZDogQ2x1c3RlclJvbGUKYXBpVmVyc2lvbjogcmJhYy5hdXRob3JpemF0aW9uLms4cy5pby92MWJldGExCm1ldGFkYXRhOgogIG5hbWU6IHRyYWVmaWstaW5ncmVzcy1jb250cm9sbGVyCgpydWxlczoKICAtIGFwaUdyb3VwczoKICAgICAgLSAiIgogICAgcmVzb3VyY2VzOgogICAgICAtIHNlcnZpY2VzCiAgICAgIC0gZW5kcG9pbnRzCiAgICAgIC0gc2VjcmV0cwogICAgdmVyYnM6CiAgICAgIC0gZ2V0CiAgICAgIC0gbGlzdAogICAgICAtIHdhdGNoCiAgLSBhcGlHcm91cHM6CiAgICAgIC0gZXh0ZW5zaW9ucwogICAgcmVzb3VyY2VzOgogICAgICAtIGluZ3Jlc3NlcwogICAgdmVyYnM6CiAgICAgIC0gZ2V0CiAgICAgIC0gbGlzdAogICAgICAtIHdhdGNoCiAgLSBhcGlHcm91cHM6CiAgICAgIC0gZXh0ZW5zaW9ucwogICAgcmVzb3VyY2VzOgogICAgICAtIGluZ3Jlc3Nlcy9zdGF0dXMKICAgIHZlcmJzOgogICAgICAtIHVwZGF0ZQogIC0gYXBpR3JvdXBzOgogICAgICAtIHRyYWVmaWsuY29udGFpbm8udXMKICAgIHJlc291cmNlczoKICAgICAgLSBtaWRkbGV3YXJlcwogICAgdmVyYnM6CiAgICAgIC0gZ2V0CiAgICAgIC0gbGlzdAogICAgICAtIHdhdGNoCiAgLSBhcGlHcm91cHM6CiAgICAgIC0gdHJhZWZpay5jb250YWluby51cwogICAgcmVzb3VyY2VzOgogICAgICAtIGluZ3Jlc3Nyb3V0ZXMKICAgIHZlcmJzOgogICAgICAtIGdldAogICAgICAtIGxpc3QKICAgICAgLSB3YXRjaAogIC0gYXBpR3JvdXBzOgogICAgICAtIHRyYWVmaWsuY29udGFpbm8udXMKICAgIHJlc291cmNlczoKICAgICAgLSBpbmdyZXNzcm91dGV0Y3BzCiAgICB2ZXJiczoKICAgICAgLSBnZXQKICAgICAgLSBsaXN0CiAgICAgIC0gd2F0Y2gKICAtIGFwaUdyb3VwczoKICAgICAgLSB0cmFlZmlrLmNvbnRhaW5vLnVzCiAgICByZXNvdXJjZXM6CiAgICAgIC0gdGxzb3B0aW9ucwogICAgdmVyYnM6CiAgICAgIC0gZ2V0CiAgICAgIC0gbGlzdAogICAgICAtIHdhdGNoCiAgLSBhcGlHcm91cHM6CiAgICAgIC0gdHJhZWZpay5jb250YWluby51cwogICAgcmVzb3VyY2VzOgogICAgICAtIHRyYWVmaWtzZXJ2aWNlcwogICAgdmVyYnM6CiAgICAgIC0gZ2V0CiAgICAgIC0gbGlzdAogICAgICAtIHdhdGNoCgotLS0Ka2luZDogQ2x1c3RlclJvbGVCaW5kaW5nCmFwaVZlcnNpb246IHJiYWMuYXV0aG9yaXphdGlvbi5rOHMuaW8vdjFiZXRhMQptZXRhZGF0YToKICBuYW1lOiB0cmFlZmlrLWluZ3Jlc3MtY29udHJvbGxlcgoKcm9sZVJlZjoKICBhcGlHcm91cDogcmJhYy5hdXRob3JpemF0aW9uLms4cy5pbwogIGtpbmQ6IENsdXN0ZXJSb2xlCiAgbmFtZTogdHJhZWZpay1pbmdyZXNzLWNvbnRyb2xsZXIKc3ViamVjdHM6CiAgLSBraW5kOiBTZXJ2aWNlQWNjb3VudAogICAgbmFtZTogdHJhZWZpay1pbmdyZXNzLWNvbnRyb2xsZXIKICAgIG5hbWVzcGFjZTogdHJhZWZpawoKLS0tCmFwaVZlcnNpb246IHYxCmtpbmQ6IFNlcnZpY2VBY2NvdW50Cm1ldGFkYXRhOgogIG5hbWU6IHRyYWVmaWstaW5ncmVzcy1jb250cm9sbGVyCiAgbmFtZXNwYWNlOiB0cmFlZmlrCg=="
    - path: "/opt/traefik/traefik-02-operator.yaml"
      user:
        name: root
      group:
        name: root
      mode: 0644
      contents:
        # cat traefik/02-operator.yaml | base64 -w 0
        source: "data:text/plain;charset=utf-8;base64,a2luZDogRGVwbG95bWVudAphcGlWZXJzaW9uOiBhcHBzL3YxCm1ldGFkYXRhOgogIG5hbWU6IHRyYWVmaWsKICBuYW1lc3BhY2U6IHRyYWVmaWsKICBsYWJlbHM6CiAgICBhcHA6IHRyYWVmaWsKc3BlYzoKICByZXBsaWNhczogMQogIHNlbGVjdG9yOgogICAgbWF0Y2hMYWJlbHM6CiAgICAgIGFwcDogdHJhZWZpawogIHRlbXBsYXRlOgogICAgbWV0YWRhdGE6CiAgICAgIGxhYmVsczoKICAgICAgICBhcHA6IHRyYWVmaWsKICAgIHNwZWM6CiAgICAgIHNlcnZpY2VBY2NvdW50TmFtZTogdHJhZWZpay1pbmdyZXNzLWNvbnRyb2xsZXIKICAgICAgYWZmaW5pdHk6CiAgICAgICAgbm9kZUFmZmluaXR5OgogICAgICAgICAgcmVxdWlyZWREdXJpbmdTY2hlZHVsaW5nSWdub3JlZER1cmluZ0V4ZWN1dGlvbjoKICAgICAgICAgICAgbm9kZVNlbGVjdG9yVGVybXM6CiAgICAgICAgICAgICAgLSBtYXRjaEV4cHJlc3Npb25zOgogICAgICAgICAgICAgICAgICAtIGtleTogIm5vZGUtcm9sZS5rdWJlcm5ldGVzLmlvL21hc3RlciIKICAgICAgICAgICAgICAgICAgICBvcGVyYXRvcjogSW4KICAgICAgICAgICAgICAgICAgICB2YWx1ZXM6CiAgICAgICAgICAgICAgICAgICAgICAtICJ0cnVlIgogICAgICBjb250YWluZXJzOgogICAgICAgIC0gbmFtZTogdHJhZWZpawogICAgICAgICAgaW1hZ2U6IHRyYWVmaWs6djIuMQogICAgICAgICAgYXJnczoKICAgICAgICAgICAgLSAtLWFwaS5kYXNoYm9hcmQKICAgICAgICAgICAgLSAtLWFwaS5pbnNlY3VyZQogICAgICAgICAgICAtIC0tbG9nLmxldmVsPURFQlVHCiAgICAgICAgICAgIC0gLS1nbG9iYWwuc2VuZEFub255bW91c1VzYWdlCiAgICAgICAgICAgIC0gLS1wcm92aWRlcnMua3ViZXJuZXRlc2NyZAogICAgICAgICAgICAtIC0tZW50cnlwb2ludHMuaHR0cC5hZGRyZXNzPTo2MDgwCiAgICAgICAgICAgIC0gLS1lbnRyeXBvaW50cy5odHRwcy5hZGRyZXNzPTo2NDQzCiAgICAgICAgICAgIC0gLS1jZXJ0aWZpY2F0ZXNyZXNvbHZlcnMubGV0c2VuY3J5cHQuYWNtZS50bHNjaGFsbGVuZ2UKICAgICAgICAgICAgLSAtLWNlcnRpZmljYXRlc3Jlc29sdmVycy5sZXRzZW5jcnlwdC5hY21lLmNhc2VydmVyPWh0dHBzOi8vYWNtZS1zdGFnaW5nLXYwMi5hcGkubGV0c2VuY3J5cHQub3JnL2RpcmVjdG9yeQogICAgICAgICAgICAtIC0tY2VydGlmaWNhdGVzcmVzb2x2ZXJzLmxldHNlbmNyeXB0LmFjbWUuZW1haWw9bm9yZXBseUBkb2xhbnk4MS5uZXQKICAgICAgICAgICAgLSAtLWNlcnRpZmljYXRlc3Jlc29sdmVycy5sZXRzZW5jcnlwdC5hY21lLnN0b3JhZ2U9L3RyYWVmaWsvYWNtZS5qc29uCiAgICAgICAgICBwb3J0czoKICAgICAgICAgICAgLSBuYW1lOiBodHRwCiAgICAgICAgICAgICAgY29udGFpbmVyUG9ydDogNjA4MAogICAgICAgICAgICAgIGhvc3RQb3J0OiA4MAogICAgICAgICAgICAtIG5hbWU6IGh0dHBzCiAgICAgICAgICAgICAgY29udGFpbmVyUG9ydDogNjQ0MwogICAgICAgICAgICAgIGhvc3RQb3J0OiA0NDMKICAgICAgICAgICAgLSBuYW1lOiB0cmFlZmlrCiAgICAgICAgICAgICAgY29udGFpbmVyUG9ydDogODA4MAoKLS0tCmtpbmQ6IEluZ3Jlc3NSb3V0ZQphcGlWZXJzaW9uOiB0cmFlZmlrLmNvbnRhaW5vLnVzL3YxYWxwaGExCm1ldGFkYXRhOgogIG5hbWU6IHRyYWVmaWstZGFzaGJvYXJkCiAgbmFtZXNwYWNlOiB0cmFlZmlrCnNwZWM6CiAgZW50cnlQb2ludHM6CiAgICAtIGh0dHBzCiAgcm91dGVzOgogICAgLSBraW5kOiBSdWxlCiAgICAgIG1hdGNoOiBIb3N0KGB0cmFlZmlrLmRvbGFueTgxLm5ldGApCiAgICAgIHNlcnZpY2VzOgogICAgICAgIC0ga2luZDogVHJhZWZpa1NlcnZpY2UKICAgICAgICAgIG5hbWU6IGFwaUBpbnRlcm5hbAogIHRsczoKICAgIGNlcnRyZXNvbHZlcjogbGV0c2VuY3J5cHQK"
    - path: "/opt/traefik/traefik-03-http-redirect.yaml"
      user:
        name: root
      group:
        name: root
      mode: 0644
      contents:
        # cat traefik/03-http-redirect.yaml | base64 -w 0
        source: "data:text/plain;charset=utf-8;base64,IyBNaWRkbGV3YXJlIHRvIHJlZGlyZWN0IGFsbCBIVFRQIHRvIEhUVFBTCmtpbmQ6IE1pZGRsZXdhcmUKYXBpVmVyc2lvbjogdHJhZWZpay5jb250YWluby51cy92MWFscGhhMQptZXRhZGF0YToKICBuYW1lOiBodHRwLXJlZGlyZWN0CnNwZWM6CiAgcmVkaXJlY3RSZWdleDoKICAgIHBlcm1hbmVudDogdHJ1ZQogICAgcmVnZXg6IF5odHRwOi8vKC4qKQogICAgcmVwbGFjZW1lbnQ6IGh0dHBzOi8vJHsxfQoKLS0tCiMgVGhlIGdsb2JhbCBIVFRQIHJlZGlyZWN0CmtpbmQ6IEluZ3Jlc3NSb3V0ZQphcGlWZXJzaW9uOiB0cmFlZmlrLmNvbnRhaW5vLnVzL3YxYWxwaGExCm1ldGFkYXRhOgogIG5hbWU6IGh0dHAtcmVkaXJlY3QKCnNwZWM6CiAgZW50cnlQb2ludHM6CiAgICAtIGh0dHAKICByb3V0ZXM6CiAgICAtIGtpbmQ6IFJ1bGUKICAgICAgbWF0Y2g6IFBhdGhQcmVmaXgoYC9gKQogICAgICBzZXJ2aWNlczoKICAgICAgICAtIGtpbmQ6IFRyYWVmaWtTZXJ2aWNlCiAgICAgICAgICBuYW1lOiBhcGlAaW50ZXJuYWwKICAgICAgbWlkZGxld2FyZXM6CiAgICAgICAgLSBuYW1lOiBodHRwLXJlZGlyZWN0Cg=="
    # Rook/Ceph
    - path: "/opt/rook/ceph-01-common.yaml"
      user:
        name: root
      group:
        name: root
      mode: 0644
      contents:
        source: "https://raw.githubusercontent.com/rook/rook/v1.2.0/cluster/examples/kubernetes/ceph/common.yaml"
        verification:
          # curl -s https://raw.githubusercontent.com/rook/rook/v1.2.0/cluster/examples/kubernetes/ceph/common.yaml | sha512sum | cut -d ' ' -f 1
          hash: sha512-057e38ca8e7066df8eb6449ef7e35e390825f8bfc2cd7d46ca1e464273a990e965031030f92d090e963b05c06e0989d6e5a059b658931f3972e706358b6f71d8
    - path: "/opt/rook/ceph-02-operator.yaml"
      user:
        name: root
      group:
        name: root
      mode: 0644
      contents:
        source: "https://raw.githubusercontent.com/rook/rook/v1.2.0/cluster/examples/kubernetes/ceph/operator.yaml"
        verification:
          # curl -s https://raw.githubusercontent.com/rook/rook/v1.2.0/cluster/examples/kubernetes/ceph/operator.yaml | sha512sum | cut -d ' ' -f 1
          hash: sha512-0dc6212344da92ead92b6e81cfa51f2659664462ae8d12beded92fb34137e4d638520b5e93453980831b5b8549fac83256a68268c448a76e715b38f8e9d277c0
    - path: "/opt/rook/ceph-03-cluster.yaml"
      user:
        name: root
      group:
        name: root
      mode: 0644
      contents:
        # cat rook/03-cluster.yaml | base64 -w 0
        source: "data:text/plain;charset=utf-8;base64,YXBpVmVyc2lvbjogY2VwaC5yb29rLmlvL3YxCmtpbmQ6IENlcGhDbHVzdGVyCm1ldGFkYXRhOgogIG5hbWU6IHJvb2stY2VwaAogIG5hbWVzcGFjZTogcm9vay1jZXBoCnNwZWM6CiAgY2VwaFZlcnNpb246CiAgICAjIGh0dHBzOi8vaHViLmRvY2tlci5jb20vci9jZXBoL2NlcGgvdGFncwogICAgaW1hZ2U6IGNlcGgvY2VwaDp2MTQuMi41CiAgZGF0YURpckhvc3RQYXRoOiAvdmFyL2xpYi9yb29rCiAgbW9uOgogICAgY291bnQ6IDMKICBkYXNoYm9hcmQ6CiAgICBlbmFibGVkOiB0cnVlCiAgICBwb3J0OiA4MDgwCiAgICBzc2w6IGZhbHNlCiAgbW9uaXRvcmluZzoKICAgIGVuYWJsZWQ6IGZhbHNlCiAgbmV0d29yazoKICAgIGhvc3ROZXR3b3JrOiBmYWxzZQogIHN0b3JhZ2U6CiAgICB1c2VBbGxOb2RlczogdHJ1ZQogICAgdXNlQWxsRGV2aWNlczogZmFsc2UKICAgIGRldmljZUZpbHRlcjogInNkYiIKICAgIGNvbmZpZzoKICAgICAgb3Nkc1BlckRldmljZTogIjEiCiAgcGxhY2VtZW50OgogICAgbWdyOgogICAgICBub2RlQWZmaW5pdHk6CiAgICAgICAgcmVxdWlyZWREdXJpbmdTY2hlZHVsaW5nSWdub3JlZER1cmluZ0V4ZWN1dGlvbjoKICAgICAgICAgIG5vZGVTZWxlY3RvclRlcm1zOgogICAgICAgICAgLSBtYXRjaEV4cHJlc3Npb25zOgogICAgICAgICAgICAtIGtleTogIm5vZGUtcm9sZS5rdWJlcm5ldGVzLmlvL21hc3RlciIKICAgICAgICAgICAgICBvcGVyYXRvcjogSW4KICAgICAgICAgICAgICB2YWx1ZXM6CiAgICAgICAgICAgICAgLSAidHJ1ZSIK"
    - path: "/opt/rook/ceph-04-dashboard-ingress.yaml"
      user:
        name: root
      group:
        name: root
      mode: 0644
      contents:
        # cat rook/04-dashboard-ingress.yaml | base64 -w 0
        source: "data:text/plain;charset=utf-8;base64,YXBpVmVyc2lvbjogZXh0ZW5zaW9ucy92MWJldGExCmtpbmQ6IEluZ3Jlc3MKbWV0YWRhdGE6CiAgbmFtZTogcm9vay1jZXBoLW1nci1kYXNoYm9hcmQKICBuYW1lc3BhY2U6IHJvb2stY2VwaAogIGFubm90YXRpb25zOgogICAga3ViZXJuZXRlcy5pby9pbmdyZXNzLmNsYXNzOiAidHJhZWZpayIKc3BlYzoKICBydWxlczoKICAtIGhvc3Q6IHJvb2stY2VwaC5kb2xhbnk4MS5uZXQKICAgIGh0dHA6CiAgICAgIHBhdGhzOgogICAgICAgIC0gcGF0aDogLwogICAgICAgICAgYmFja2VuZDoKICAgICAgICAgICAgc2VydmljZU5hbWU6IHJvb2stY2VwaC1tZ3ItZGFzaGJvYXJkCiAgICAgICAgICAgIHNlcnZpY2VQb3J0OiBkYXNoYm9hcmQK"
    - path: "/opt/rook/ceph-05-filesystem.yaml"
      user:
        name: root
      group:
        name: root
      mode: 0644
      contents:
        # cat rook/05-filesystem.yaml | base64 -w 0
        source: "data:text/plain;charset=utf-8;base64,YXBpVmVyc2lvbjogY2VwaC5yb29rLmlvL3YxCmtpbmQ6IENlcGhGaWxlc3lzdGVtCm1ldGFkYXRhOgogIG5hbWU6IGRvbGFueTgxLm5ldAogIG5hbWVzcGFjZTogcm9vay1jZXBoCgpzcGVjOgogIG1ldGFkYXRhUG9vbDoKICAgIGZhaWx1cmVEb21haW46IGhvc3QKICAgIHJlcGxpY2F0ZWQ6CiAgICAgIHNpemU6IDMKICBkYXRhUG9vbHM6CiAgICAtIGZhaWx1cmVEb21haW46IGhvc3QKICAgICAgcmVwbGljYXRlZDoKICAgICAgICBzaXplOiAzCiAgcHJlc2VydmVQb29sc09uRGVsZXRlOiB0cnVlCiAgbWV0YWRhdGFTZXJ2ZXI6CiAgICBhY3RpdmVDb3VudDogMQogICAgYWN0aXZlU3RhbmRieTogdHJ1ZQo="

systemd:
  units:
    - name: k3s.service
      enabled: true
      contents: |
        [Unit]
        Description=Lightweight Kubernetes
        Documentation=https://k3s.io
        After=network-online.target

        [Install]
        WantedBy=multi-user.target

        [Service]
        Type=notify
        KillMode=process
        Delegate=yes
        LimitNOFILE=infinity
        LimitNPROC=infinity
        LimitCORE=infinity
        TasksMax=infinity
        TimeoutStartSec=0
        Restart=always
        RestartSec=5s
        ExecStartPre=-/sbin/modprobe br_netfilter
        ExecStartPre=-/sbin/modprobe overlay
        ExecStart=/usr/local/bin/k3s server \
          --cluster-domain example.net \
          --token-file /usr/local/etc/k3s/token \
          --no-deploy traefik
